Introduction
============

Shekels is a local service which consumes a transactions CSV file
downloaded from mint.intuit.com. It conforms this data into a database,
and displays it as a searchable table and dashboard of configurable
plots in web frontend.

See `documentation <https://thenewflesh.github.io/shekels/>`__ for
details.

On the documentation main page, under the *Architecture* section, is a
dynamically generated dependency graph of shekels' current architecture.
It is generated using the RepoETL class.

If you look under the *Metrics* section you will find Radon code metric
plots and data of the shekels' source code, generated by the RadonETL
class.
--------------

Installation
============

Python
~~~~~~

``pip install shekels``

Docker
~~~~~~

1. Install `docker-desktop <https://docs.docker.com/desktop/>`__
2. ``docker pull thenewflesh/shekels:latest``

Docker For Developers
~~~~~~~~~~~~~~~~~~~~~

1. Install `docker-desktop <https://docs.docker.com/desktop/>`__
2. Ensure docker-desktop has at least 4 GB of memory allocated to it.
3. ``git clone git@github.com:theNewFlesh/shekels.git``
4. ``cd shekels``
5. ``chmod +x bin/shekels``
6. ``bin/shekels start``

The service should take a few minutes to start up.

Run ``bin/shekels --help`` for more help on the command line tool.

--------------

Production CLI
==============

shekels comes with a command line interface defined in command.py.

Its usage pattern is: ``shekels COMMAND [ARGS] [FLAGS] [-h --help]``

Commands
--------

--------------

bash-completion
~~~~~~~~~~~~~~~

Prints BASH completion code to be written to a \_shekels completion
file

Usage: ``shekels bash-completion``

--------------

zsh-completion
~~~~~~~~~~~~~~

Prints ZSH completion code to be written to a \_shekels completion
file

Usage: ``shekels zsh-completion``

--------------

Development CLI
===============

bin/shekels is a command line interface (defined in cli.py) that
works with any version of python 2.7 and above, as it has no
dependencies.

Its usage pattern is:
``bin/shekels COMMAND [-a --args]=ARGS [-h --help] [--dryrun]``

.. _commands-1:

Commands
~~~~~~~~

+---------------+------------------------------------------------------+
| Command       | Description                                          |
+===============+======================================================+
| build-package | Build production version of repo for publishing      |
+---------------+------------------------------------------------------+
| build-prod    | Publish pip package of repo to PyPi                  |
+---------------+------------------------------------------------------+
| build-publish | Run production tests first then publish pip package  |
|               | of repo to PyPi                                      |
+---------------+------------------------------------------------------+
| build-test    | Build test version of repo for prod testing          |
+---------------+------------------------------------------------------+
| docker-build  | Build image of shekels                               |
+---------------+------------------------------------------------------+
| dock          | Build production image of shekels                    |
| er-build-prod |                                                      |
+---------------+------------------------------------------------------+
| doc           | Display the Docker container id of shekels           |
| ker-container |                                                      |
+---------------+------------------------------------------------------+
| do            | Generate coverage report for shekels                 |
| cker-coverage |                                                      |
+---------------+------------------------------------------------------+
| d             | Shutdown shekels container and destroy its image     |
| ocker-destroy |                                                      |
+---------------+------------------------------------------------------+
| docker        | Shutdown shekels production container and            |
| -destroy-prod | destroy its image                                    |
+---------------+------------------------------------------------------+
| docker-image  | Display the Docker image id of shekels               |
+---------------+------------------------------------------------------+
| docker-prod   | Start shekels production container                   |
+---------------+------------------------------------------------------+
| docker-push   | Push shekels production image to Dockerhub           |
+---------------+------------------------------------------------------+
| docker-remove | Remove shekels Docker image                          |
+---------------+------------------------------------------------------+
| d             | Restart shekels container                            |
| ocker-restart |                                                      |
+---------------+------------------------------------------------------+
| docker-start  | Start shekels container                              |
+---------------+------------------------------------------------------+
| docker-stop   | Stop shekels container                               |
+---------------+------------------------------------------------------+
| docs          | Generate sphinx documentation                        |
+---------------+------------------------------------------------------+
| docs          | Generate architecture.svg diagram from all import    |
| -architecture | statements                                           |
+---------------+------------------------------------------------------+
| docs-full     | Generate documentation, coverage report, diagram and |
|               | code                                                 |
+---------------+------------------------------------------------------+
| docs-metrics  | Generate code metrics report, plots and tables       |
+---------------+------------------------------------------------------+
| library-add   | Add a given package to a given dependency group      |
+---------------+------------------------------------------------------+
| libr          | Graph dependencies in dev environment                |
| ary-graph-dev |                                                      |
+---------------+------------------------------------------------------+
| libra         | Graph dependencies in prod environment               |
| ry-graph-prod |                                                      |
+---------------+------------------------------------------------------+
| librar        | Install all dependencies into dev environment        |
| y-install-dev |                                                      |
+---------------+------------------------------------------------------+
| library       | Install all dependencies into prod environment       |
| -install-prod |                                                      |
+---------------+------------------------------------------------------+
| lib           | List packages in dev environment                     |
| rary-list-dev |                                                      |
+---------------+------------------------------------------------------+
| libr          | List packages in prod environment                    |
| ary-list-prod |                                                      |
+---------------+------------------------------------------------------+
| lib           | Resolve dev.lock file                                |
| rary-lock-dev |                                                      |
+---------------+------------------------------------------------------+
| libr          | Resolve prod.lock file                               |
| ary-lock-prod |                                                      |
+---------------+------------------------------------------------------+
| l             | Remove a given package from a given dependency group |
| ibrary-remove |                                                      |
+---------------+------------------------------------------------------+
| l             | Search for pip packages                              |
| ibrary-search |                                                      |
+---------------+------------------------------------------------------+
| lib           | Sync dev environment with packages listed in         |
| rary-sync-dev | dev.lock                                             |
+---------------+------------------------------------------------------+
| libr          | Sync prod environment with packages listed in        |
| ary-sync-prod | prod.lock                                            |
+---------------+------------------------------------------------------+
| l             | Update dev dependencies                              |
| ibrary-update |                                                      |
+---------------+------------------------------------------------------+
| session-lab   | Run jupyter lab server                               |
+---------------+------------------------------------------------------+
| s             | Run python session with dev dependencies             |
| ession-python |                                                      |
+---------------+------------------------------------------------------+
| state         | State of shekels                                     |
+---------------+------------------------------------------------------+
| test-coverage | Generate test coverage report                        |
+---------------+------------------------------------------------------+
| test-dev      | Run all tests                                        |
+---------------+------------------------------------------------------+
| test-fast     | Test all code excepts tests marked with              |
|               | SKIP_SLOWS_TESTS decorator                           |
+---------------+------------------------------------------------------+
| test-lint     | Run linting and type checking                        |
+---------------+------------------------------------------------------+
| test-prod     | Run tests across all support python versions         |
+---------------+------------------------------------------------------+
| version       | Full resolution of repo: dependencies, linting,      |
|               | tests, docs, etc                                     |
+---------------+------------------------------------------------------+
| versi         | Bump pyproject major version                         |
| on-bump-major |                                                      |
+---------------+------------------------------------------------------+
| versi         | Bump pyproject minor version                         |
| on-bump-minor |                                                      |
+---------------+------------------------------------------------------+
| versi         | Bump pyproject patch version                         |
| on-bump-patch |                                                      |
+---------------+------------------------------------------------------+
| zsh           | Run ZSH session inside shekels container             |
+---------------+------------------------------------------------------+
| zsh-complete  | Generate oh-my-zsh completions                       |
+---------------+------------------------------------------------------+
| zsh-root      | Run ZSH session as root inside shekels container     |
+---------------+------------------------------------------------------+

Flags
~~~~~

===== ======= ====================================================
Short Long    Description
===== ======= ====================================================
-a    –args   Additional arguments, this can generally be ignored
-h    –help   Prints command help message to stdout
\     –dryrun Prints command that would otherwise be run to stdout
===== ======= ====================================================
